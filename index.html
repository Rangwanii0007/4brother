<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdWatch Pro | Earn Points Watching Ads</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://www.gstatic.com; style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; img-src 'self' https://storage.googleapis.com data:; connect-src 'self' https://www.gstatic.com; font-src 'self' https://cdnjs.cloudflare.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }
        
        .card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .notification-popup {
            animation: slideIn 0.5s forwards, fadeOut 0.5s 4.5s forwards;
            transform: translateX(100%);
        }
        
        @keyframes slideIn {
            to { transform: translateX(0); }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
        
        .progress-bar {
            height: 6px;
            width: 100%;
            background: #e2e8f0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Top Navigation -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-ad text-2xl"></i>
                <span class="text-xl font-bold">AdWatch Pro</span>
            </div>
            <div class="flex items-center space-x-4">
                <div class="hidden md:flex items-center space-x-4">
                    <span class="font-medium">Welcome, <span id="username">Guest</span></span>
                    <span class="bg-indigo-700 px-3 py-1 rounded-full">
                        <i class="fas fa-coins mr-1"></i>
                        <span id="userPoints">0</span> points
                    </span>
                </div>
                <button id="loginBtn" class="bg-white text-indigo-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 transition">Login/Signup</button>
            </div>
        </div>
    </nav>

    <!-- Quick Stats Banner -->
    <div class="bg-indigo-50 py-4">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-2 md:mb-0">
                    <span class="text-sm font-medium text-indigo-600">TODAY'S TOTAL REWARDS</span>
                    <div class="text-2xl font-bold text-indigo-800">$12,456</div>
                </div>
                <div class="flex space-x-6 text-center">
                    <div>
                        <span class="text-sm font-medium text-indigo-600">ACTIVE USERS</span>
                        <div class="text-xl font-bold text-indigo-800">3,124</div>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-indigo-600">ADS WATCHED</span>
                        <div class="text-xl font-bold text-indigo-800">28,761</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Premium Link Section -->
                <div id="premiumLinkSection" class="card bg-white rounded-xl p-6 shadow-md border border-yellow-300 pulse">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-crown text-yellow-500 mr-2"></i>
                            Special Offer - Earn 100 Points!
                        </h2>
                        <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded">
                            Every 2 minutes
                        </span>
                    </div>
                    <p class="text-gray-600 mb-4">Watch premium ads to earn <span class="font-bold text-yellow-600">100 points</span> every 2 minutes!</p>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="text-gray-500 text-sm">Premium Partner Link 1:</span>
                                <div class="font-medium">profitableratecpm.com/v30v9iyyx</div>
                                <button id="visitPremiumBtn1" 
                                    class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-md font-medium transition flex items-center justify-center w-full mt-2 disabled:opacity-75" 
                                    data-locked="false"
                                    data-last-click="0">
                                    <span class="mr-2" id="premiumBtnText1">Visit Now</span>
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                                <div id="cooldown1" class="text-xs text-gray-500 mt-1 hidden"><i class="fas fa-lock mr-1"></i> Available in: <span id="countdown1">2:00</span></div>
                            </div>
                            <div>
                                <span class="text-gray-500 text-sm">Premium Partner Link 2:</span>
                                <div class="font-medium">profitableratecpm.com/i3gkm6gh</div>
                                <button id="visitPremiumBtn2" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-md font-medium transition flex items-center justify-center w-full mt-2" data-locked="false">
                                    <span class="mr-2" id="premiumBtnText2">Visit Now</span>
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                                <div id="cooldown2" class="text-xs text-gray-500 mt-1 hidden"><i class="fas fa-lock mr-1"></i> Available in: <span id="countdown2">2:00</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-4 text-sm text-gray-500">
                        <span><i class="fas fa-user-shield mr-1"></i> Premium offers available every 2 minutes</span>
                    </div>
                </div>

                <!-- My Links Section -->
                <div id="myLinksSection" class="card bg-white rounded-xl p-6 shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-link mr-2 text-indigo-600"></i>
                            My Links
                        </h2>
                        <button id="addLinkBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-medium transition flex items-center">
                            <i class="fas fa-plus mr-2"></i> Add Link
                        </button>
                    </div>
                    
                    <div id="linksList" class="space-y-3">
                        <div class="border-b pb-2 border-gray-200">
                            <p class="text-sm text-gray-400 mb-1 flex items-center">
                                <span>No links added yet</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Other Users Links Section -->
                <div id="otherLinksSection" class="card bg-white rounded-xl p-6 shadow-md">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center mb-4">
                        <i class="fas fa-users mr-2 text-blue-500"></i>
                        Links From Other Users
                    </h2>
                    <div id="otherUserLinksList" class="space-y-3">
                        <div class="text-sm text-gray-400 mb-1 italic">
                            Links will appear here when users share them
                        </div>
                    </div>
                </div>

                <!-- User Links Section - Watch & Earn -->
                <div class="card bg-white rounded-xl p-6 shadow-md">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center mb-4">
                        <i class="fas fa-bolt mr-2 text-green-600"></i>
                        Watch Links & Earn Points
                    </h2>
                    <p class="text-gray-600 mb-4">Watch other users' links to earn points. The owner gets traffic when you watch!</p>
                    <div id="userLinksToWatch" class="space-y-4">
                        <!-- User links will appear here -->
                        <div class="text-sm text-gray-400 italic">Links submitted by other users will appear here</div>
                    </div>
                </div>

                <!-- Watch Ads Section -->
                <div class="card bg-white rounded-xl p-6 shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-ad mr-2 text-green-600"></i>
                            Watch Ads & Earn Points
                        </h2>
                        <div class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">
                            <i class="fas fa-coins mr-1"></i> 10 pts per ad
                        </div>
                    </div>
                    
                    <p class="text-gray-600 mb-4">Watch these ads completely to earn 10 points each. More ads will appear as you watch.</p>
                    
                    <div id="adsContainer" class="space-y-4">
                        <!-- Ad items will be inserted here by JavaScript -->
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-3">
                                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/1d2ceb69-66ba-4ac5-9077-3a52df4ba0ae.png" alt="Brand logo for FashionFusion showing minimalist clothing graphic" class="rounded-full w-10 h-10 object-cover">
                                    <div>
                                        <div class="font-medium">FashionFusion</div>
                                        <div class="text-xs text-gray-500">Sponsored • Ends in 12h</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="relative aspect-video bg-gray-100 rounded overflow-hidden mb-3">
                                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/7805cc9f-8a45-464a-9fa0-61d3a560d0bf.png" alt="Promotional video frame showing summer collection of stylish clothing with models wearing the latest fashion trends" class="w-full h-full object-cover">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <button class="bg-black bg-opacity-50 text-white rounded-full w-16 h-16 flex items-center justify-center hover:bg-opacity-70 transition">
                                        <i class="fas fa-play text-2xl"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            
                            <div class="flex justify-between items-center mt-2 text-sm">
                                <span class="text-gray-500">Watch complete ad to earn 10 points</span>
                                <div class="flex items-center">
                                    <button class="watch-now-btn bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1 rounded text-sm font-medium transition flex items-center">
                                        <i class="fas fa-play-circle mr-2"></i>
                                        Watch Now
                                    </button>
                                    <div class="ml-3 text-xs text-indigo-600">
                                        <i class="fas fa-bolt"></i>
                                        <span>10 XP</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="newAdsNotice" class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4 text-blue-800 hidden">
                        <i class="fas fa-sync-alt mr-2"></i> Refreshing ads in <span id="refreshCountdown">10</span> seconds...
                    </div>
                </div>
            </div>
            
            <!-- Right Column -->
            <div class="space-y-6">
                <!-- User Stats Card -->
                <div class="card bg-white rounded-xl p-6 shadow-md">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="bg-indigo-100 text-indigo-600 rounded-full w-16 h-16 flex items-center justify-center">
                            <i class="fas fa-user text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800" id="statsUserName">Welcome Guest</h3>
                            <p class="text-sm text-gray-500">Member since <span id="memberSince">-</span></p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-500">Account Status</span>
                                <span id="accountStatus" class="font-medium text-indigo-600">Basic</span>
                            </div>
                            <div class="progress-bar">
                                <div id="statusProgress" class="progress-fill" style="width: 25%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Upgrade to Premium at 5000 points</p>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-500">Points Balance</span>
                                <span class="font-bold text-indigo-700" id="pointsBalance">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Earned Today</span>
                                <span class="font-medium" id="earnedToday">0</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <div class="text-gray-500 text-sm">Ads Watched</div>
                                <div class="font-bold text-indigo-700" id="adsWatched">0</div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <div class="text-gray-500 text-sm">Links Shared</div>
                                <div class="font-bold text-indigo-700" id="linksShared">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Get Traffic Section -->
                <div class="card bg-white rounded-xl p-6 shadow-md">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center mb-4">
                        <i class="fas fa-rocket mr-2 text-purple-600"></i>
                        Get More Traffic
                    </h2>
                    
                    <p class="text-gray-600 mb-4">Spend your points to get more clicks and impressions on your links.</p>
                    
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-info-circle text-purple-600 mr-2"></i>
                            <span class="text-purple-800 font-medium">Conversion Rate</span>
                        </div>
                        <p class="text-sm text-purple-700">10 points = 1 click + 5 impressions</p>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-gray-700 text-sm font-medium" for="pointsToSpend">
                                Points to Spend
                            </label>
                            <div class="flex items-center space-x-2">
                                <button class="text-xs px-2 py-1 bg-gray-100 rounded" onclick="document.getElementById('pointsToSpend').value=Math.min(parseInt(document.getElementById('pointsToSpend').value||0)+10, state.user.points)">+10</button>
                                <button class="text-xs px-2 py-1 bg-gray-100 rounded" onclick="document.getElementById('pointsToSpend').value=Math.min(parseInt(document.getElementById('pointsToSpend').value||0)+100, state.user.points)">+100</button>
                            </div>
                        </div>
                        <div class="relative">
                            <input type="range" id="pointsSlider" min="10" max="500" step="10" 
                                   class="w-full mb-2" 
                                   oninput="document.getElementById('pointsToSpend').value=this.value; calculateTraffic()">
                            <input type="number" id="pointsToSpend" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" 
                                   min="10" step="10" placeholder="Min 10 points"
                                   oninput="document.getElementById('pointsSlider').value=this.value; calculateTraffic()">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="selectLink">
                            Select Your Link
                        </label>
                        <select id="selectLink" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                            <option value="">No links available</option>
                        </select>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg mb-4">
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="text-gray-500">You will get:</div>
                            <div class="text-right font-medium">
                                <span id="calculatedClicks">0</span> clicks
                            </div>
                            <div class="text-gray-500">and</div>
                            <div class="text-right font-medium">
                                <span id="calculatedImpressions">0</span> impressions
                            </div>
                        </div>
                    </div>
                    
                    <button id="buyTrafficBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-md font-medium transition flex items-center justify-center disabled:opacity-50" disabled>
                        <span id="buyTrafficText">
                            <i class="fas fa-check-circle mr-2"></i>
                            Confirm & Distribute
                        </span>
                        <span id="buyTrafficSpinner" class="hidden">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            Processing...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Link Modal -->
    <div id="addLinkModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Add New Link</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="linkForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="linkType">
                        Link Type
                    </label>
                    <select id="linkType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="direct">Direct Link</option>
                        <option value="website">Website Link</option>
                        <option value="video">Video Link</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="linkTitle">
                        Title (Optional)
                    </label>
                    <input type="text" id="linkTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="My Awesome Link">
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="linkUrl">
                        URL
                    </label>
                    <input type="url" id="linkUrl" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="https://example.com" required
                        pattern="https?://.+" 
                        title="Include http:// or https://">
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="cancelAddLinkBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition">
                        Cancel
                    </button>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-medium transition">
                        Add Link
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Popups -->
    <div id="highEarnersNotif" class="notification-popup fixed bottom-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-xl z-50 max-w-sm hidden">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <i class="fas fa-trophy text-2xl"></i>
            </div>
            <div class="ml-3">
                <h4 class="font-bold flex items-center">
                    Top Earner Alert!
                    <span class="ml-2 bg-green-800 text-xs px-2 py-1 rounded-full">New</span>
                </h4>
                <p class="mt-1 text-sm">
                    <span id="randomHighEarner">Alex M.</span> just earned <span class="font-bold">3,450 points</span> today! 
                </p>
            </div>
        </div>
    </div>

    <div id="highTrafficNotif" class="notification-popup fixed bottom-4 right-4 bg-blue-600 text-white px-6 py-4 rounded-lg shadow-xl z-50 max-w-sm hidden mt-2">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <i class="fas fa-chart-line text-2xl"></i>
            </div>
            <div class="ml-3">
                <h4 class="font-bold flex items-center">
                    Traffic Milestone!
                    <span class="ml-2 bg-blue-800 text-xs px-2 py-1 rounded-full">New</span>
                </h4>
                <p class="mt-1 text-sm">
                    <span id="randomTrafficUser">Sarah J.</span> reached <span class="font-bold">150,000 impressions</span> this week!
                </p>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();
            
            // Enable offline persistence
            db.enablePersistence()
              .catch((err) => {
                  console.log("Firebase offline persistence error: ", err);
                  if (err.code == 'failed-precondition') {
                      console.log("Multiple tabs open, persistence can only be enabled in one tab at a time.");
                  }
              });
        } catch (err) {
            console.error("Firebase initialization error: ", err);
        }

        // Demo Data - In a real app, this would come from your backend
        const demoUsers = [
            "Alex M.", "Sarah J.", "John D.", "Emily R.", "Michael T.", 
            "Jessica L.", "David K.", "Olivia S.", "Daniel P.", "Sophia W."
        ];
        
        // State management
        let state = {
            isLoggedIn: false,
            user: {
                name: "Guest",
                points: 0,
                adsWatched: 0,
                links: [],
                memberSince: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short' })
            },
            tempLinks: [
                {
                    type: "website",
                    title: "My Portfolio",
                    url: "https://myportfolio.example.com",
                    clicks: 0,
                    impressions: 0
                }
            ]
        };
        
        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const usernameDisplay = document.getElementById('username');
        const userPointsDisplay = document.getElementById('userPoints');
        const statsUserName = document.getElementById('statsUserName');
        const pointsBalance = document.getElementById('pointsBalance');
        const earnedToday = document.getElementById('earnedToday');
        const adsWatched = document.getElementById('adsWatched');
        const linksShared = document.getElementById('linksShared');
        const memberSince = document.getElementById('memberSince');
        const premiumLinkSection = document.getElementById('premiumLinkSection');
        const visitPremiumBtn = document.getElementById('visitPremiumBtn');
        const countdown = document.getElementById('countdown');
        const myLinksSection = document.getElementById('myLinksSection');
        const linksList = document.getElementById('linksList');
        const addLinkBtn = document.getElementById('addLinkBtn');
        const adsContainer = document.getElementById('adsContainer');
        const watchNowBtns = document.querySelectorAll('.watch-now-btn');
        const newAdsNotice = document.getElementById('newAdsNotice');
        const refreshCountdown = document.getElementById('refreshCountdown');
        const pointsToSpend = document.getElementById('pointsToSpend');
        const selectLink = document.getElementById('selectLink');
        const calculatedClicks = document.getElementById('calculatedClicks');
        const calculatedImpressions = document.getElementById('calculatedImpressions');
        const buyTrafficBtn = document.getElementById('buyTrafficBtn');
        const addLinkModal = document.getElementById('addLinkModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelAddLinkBtn = document.getElementById('cancelAddLinkBtn');
        const linkForm = document.getElementById('linkForm');
        const highEarnersNotif = document.getElementById('highEarnersNotif');
        const highTrafficNotif = document.getElementById('highTrafficNotif');
        const randomHighEarner = document.getElementById('randomHighEarner');
        const randomTrafficUser = document.getElementById('randomTrafficUser');
        
        // Initialize
        let inactivityTimer;
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                if (state.isLoggedIn) {
                    alert('You will be logged out due to inactivity');
                    toggleLogin();
                }
            }, 30 * 60 * 1000); // 30 minutes
        }

        function init() {
            // Setup inactivity timer
            resetInactivityTimer();
            document.addEventListener('mousemove', resetInactivityTimer);
            document.addEventListener('keypress', resetInactivityTimer);
            loadOtherUsersLinks();
            updateUI();
            startPremiumCountdown();
            renderLinks();
            setupAdWatching();
            setupRandomNotifications();
            
            // Set up event listeners
            loginBtn.addEventListener('click', toggleLogin);
            addLinkBtn.addEventListener('click', () => addLinkModal.classList.remove('hidden'));
            closeModalBtn.addEventListener('click', () => addLinkModal.classList.add('hidden'));
            cancelAddLinkBtn.addEventListener('click', () => addLinkModal.classList.add('hidden'));
            linkForm.addEventListener('submit', handleAddLink);
            pointsToSpend.addEventListener('input', calculateTraffic);
            buyTrafficBtn.addEventListener('click', buyTraffic);
            visitPremiumBtn.addEventListener('click', visitPremiumLink);
        }
        
        // Toggle login state (demo purposes)
        function toggleLogin() {
            state.isLoggedIn = !state.isLoggedIn;
            if (state.isLoggedIn) {
                state.user.name = demoUsers[Math.floor(Math.random() * demoUsers.length)];
                state.user.points = Math.floor(Math.random() * 500);
                state.user.adsWatched = Math.floor(Math.random() * 50);
            } else {
                state.user.name = "Guest";
                state.user.points = 0;
                state.user.adsWatched = 0;
            }
            updateUI();
        }
        
        // Update UI based on state
        function updateUI() {
            usernameDisplay.textContent = state.user.name;
            userPointsDisplay.textContent = state.user.points;
            statsUserName.textContent = state.isLoggedIn ? state.user.name : "Welcome Guest";
            pointsBalance.textContent = state.user.points;
            earnedToday.textContent = Math.floor(state.user.points / 3);
            adsWatched.textContent = state.user.adsWatched;
            linksShared.textContent = state.user.links.length + state.tempLinks.length;
            memberSince.textContent = state.user.memberSince;
            
            if (state.isLoggedIn) {
                loginBtn.textContent = "Logout";
                premiumLinkSection.classList.remove('hidden');
                myLinksSection.classList.remove('hidden');
                selectLink.disabled = false;
            } else {
                loginBtn.textContent = "Login/Signup";
                premiumLinkSection.classList.add('hidden');
                myLinksSection.classList.add('hidden');
                selectLink.disabled = true;
            }
            
            // Update account status progress
            const statusProgress = document.getElementById('statusProgress');
            const progressPercentage = Math.min((state.user.points / 5000) * 100, 100);
            statusProgress.style.width = `${progressPercentage}%`;
        }
        
        // Premium link countdown timer
        function startPremiumCountdown() {
            let minutes = 4;
            let seconds = 59;
            
            const timer = setInterval(() => {
                countdown.textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
                
                if (seconds === 0) {
                    if (minutes === 0) {
                        clearInterval(timer);
                        premiumLinkSection.classList.add('hidden');
                        return;
                    }
                    minutes--;
                    seconds = 59;
                } else {
                    seconds--;
                }
            }, 1000);
        }
        
        // Render user's links
        function renderLinks() {
            linksList.innerHTML = '';
            
            const allLinks = [...state.user.links, ...state.tempLinks];
            
            if (allLinks.length === 0) {
                linksList.innerHTML = `
                    <div class="border-b pb-2 border-gray-200">
                        <p class="text-sm text-gray-400 mb-1 flex items-center">
                            <span>No links added yet</span>
                        </p>
                    </div>
                `;
                return;
            }
            
            allLinks.forEach(link => {
                const linkEl = document.createElement('div');
                linkEl.className = 'border border-gray-200 rounded-lg p-3 mb-3 last:mb-0';
                linkEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-medium text-gray-800">${link.title || 'My Link'}</p>
                            <p class="text-sm text-indigo-600 truncate">${link.url}</p>
                        </div>
                        <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                            ${link.type.charAt(0).toUpperCase() + link.type.slice(1)}
                        </span>
                    </div>
                    <div class="flex justify-between items-center mt-2 text-xs">
                        <div class="flex space-x-4">
                            <span class="text-gray-500 flex items-center">
                                <i class="fas fa-mouse-pointer mr-1"></i> ${link.clicks}
                            </span>
                            <span class="text-gray-500 flex items-center">
                                <i class="fas fa-eye mr-1"></i> ${link.impressions}
                            </span>
                        </div>
                        <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium manage-btn" data-url="${link.url}">
                            Manage
                        </button>
                    </div>
                `;
                linksList.appendChild(linkEl);
            });
            
            // Update select dropdown for traffic
            selectLink.innerHTML = '<option value="">Select a link</option>';
            allLinks.forEach(link => {
                const option = document.createElement('option');
                option.value = link.url;
                option.textContent = link.title || link.url;
                selectLink.appendChild(option);
            });
        }
        
        // Setup ad watching functionality
        function setupAdWatching() {
            // Simulate watching an ad
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('watch-now-btn') || 
                    e.target.closest('.watch-now-btn')) {
                    e.preventDefault();
                    
                    const btn = e.target.classList.contains('watch-now-btn') ? 
                                e.target : e.target.closest('.watch-now-btn');
                    const adContainer = btn.closest('.border');
                    
                    if (btn.textContent === 'Watch Now') {
                        btn.textContent = 'Watching...';
                        btn.disabled = true;
                        
                        // Start progress bar animation
                        const progressBar = adContainer.querySelector('.progress-fill');
                        let width = 0;
                        const interval = setInterval(() => {
                            if (width >= 100) {
                                clearInterval(interval);
                                completeAdWatch(btn, progressBar);
                            } else {
                                width++;
                                progressBar.style.width = `${width}%`;
                            }
                        }, 30);
                    }
                }
            });
        }
        
        // Complete watching an ad
        function completeAdWatch(btn, progressBar) {
            if (!state.isLoggedIn) {
                alert('Please login to earn points!');
                return;
            }
            
            btn.textContent = 'Thanks!';
            progressBar.style.backgroundColor = '#10b981';
            
            setTimeout(() => {
                state.user.points += 10;
                state.user.adsWatched++;
                updateUI();
                
                btn.textContent = 'Earned +10 pts';
                btn.style.backgroundColor = '#10b981';
                
                // In a real app, we would fetch new ads from server after a delay
                newAdsNotice.classList.remove('hidden');
                let count = 10;
                refreshCountdown.textContent = count;
                
                const refreshInterval = setInterval(() => {
                    count--;
                    refreshCountdown.textContent = count;
                    
                    if (count <= 0) {
                        clearInterval(refreshInterval);
                        newAdsNotice.classList.add('hidden');
                        // Here you would typically fetch new ads from the server
                        // For demo, we'll just simulate it by resetting the UI
                        btn.textContent = 'Watch Now';
                        btn.style.backgroundColor = '';
                        btn.disabled = false;
                        progressBar.style.width = '0%';
                        progressBar.style.backgroundColor = '';
                    }
                }, 1000);
            }, 1000);
        }
        
        // Calculate traffic from points
        function calculateTraffic() {
            const points = parseInt(pointsToSpend.value) || 0;
            const clicks = Math.floor(points / 10);
            const impressions = clicks * 5;
            
            calculatedClicks.textContent = clicks;
            calculatedImpressions.textContent = impressions;
            
            // Enable/disable buy button based on valid selection
            buyTrafficBtn.disabled = points < 10 || !selectLink.value;
        }
        
        // Buy traffic for a link
        // Show user's purchased links to other users
        function distributeLinks() {
            db.collection('activeLinks')
                .orderBy('timestamp', 'desc')
                .onSnapshot(snapshot => {
                    const container = document.getElementById('userLinksToWatch');
                    container.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const linkItem = document.createElement('div');
                        linkItem.className = 'border border-gray-200 rounded-lg p-4';
                        linkItem.innerHTML = `
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-3">
                                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/c364f242-8621-413f-9e91-8938e22344ce.png" alt="User avatar" class="rounded-full w-10 h-10">
                                    <div>
                                        <div class="font-medium">${data.userName}</div>
                                        <div class="text-xs text-gray-500">Spent ${data.points} points</div>
                                    </div>
                                </div>
                                <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">
                                    ${data.clicksRemaining} clicks left
                                </span>
                            </div>
                            <div class="relative aspect-video bg-gray-100 rounded overflow-hidden mb-3">
                                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/f4b1abcd-db66-41bb-bcaa-5f741ce114ea.png" alt="User submitted content preview" class="w-full h-full object-cover">
                            </div>
                            <button class="w-full watch-user-link-btn bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-md font-medium transition" 
                                    data-id="${doc.id}" data-url="${data.url}">
                                Watch & Earn 10 Points
                            </button>
                        `;
                        container.appendChild(linkItem);
                    });
                });
        }

        // Handle watching user-submitted links
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('watch-user-link-btn')) {
                const btn = e.target;
                const linkId = btn.dataset.id;
                const url = btn.dataset.url;
                
                // Show loading/progress
                btn.disabled = true;
                btn.textContent = 'Processing...';
                
                // In real app, would open the link
                setTimeout(() => {
                    // Award points to watcher
                    state.user.points += 10;
                    updateUI();
                    
                    // Update traffic stats in Firestore
                    db.collection('activeLinks').doc(linkId).update({
                        clicksRemaining: firebase.firestore.FieldValue.increment(-1),
                        impressions: firebase.firestore.FieldValue.increment(5)
                    });
                    
                    btn.textContent = 'Earned +10 Points!';
                    setTimeout(() => {
                        btn.textContent = 'Watch & Earn 10 Points';
                        btn.disabled = false;
                    }, 2000);
                }, 1500);
            }
        });

        function buyTraffic() {
            if (!state.isLoggedIn) return;
            
            const points = parseInt(pointsToSpend.value);
            if (points > state.user.points) {
                alert('Not enough points!');
                return;
            }
            
            const linkUrl = selectLink.value;
            const allLinks = [...state.user.links, ...state.tempLinks];
            const linkIndex = allLinks.findIndex(l => l.url === linkUrl);
            
            if (linkIndex !== -1) {
                const clicks = Math.floor(points / 10);
                const impressions = clicks * 5;
                
                if (linkIndex < state.user.links.length) {
                    state.user.links[linkIndex].clicks += clicks;
                    state.user.links[linkIndex].impressions += impressions;
                } else {
                    const tempIndex = linkIndex - state.user.links.length;
                    state.tempLinks[tempIndex].clicks += clicks;
                    state.tempLinks[tempIndex].impressions += impressions;
                }
                
                state.user.points -= points;
                updateUI();
                renderLinks();
                
                alert(`Success! Your link will receive ${clicks} clicks and ${impressions} impressions.`);
            }
        }
        
        // Handle adding a new link
        function handleAddLink(e) {
            e.preventDefault();
            
            const type = document.getElementById('linkType').value;
            const title = document.getElementById('linkTitle').value;
            const url = document.getElementById('linkUrl').value;
            
            if (!url) {
                alert('Please enter a URL');
                return;
            }
            
            const newLink = {
                type,
                title,
                url,
                clicks: 0,
                impressions: 0
            };
            
            state.user.links.push(newLink);
            
            // Add link to Firestore so other users can see it
            if (auth.currentUser) {
                db.collection('sharedLinks').add({
                }).catch(error => {
                    console.error("Error adding link: ", error);
                    alert("Failed to share link. Please try again.");
                    throw error;
                }).then(() => {
                    userId: auth.currentUser.uid,
                    userName: state.user.name,
                    link: newLink,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    clicks: 0,
                    impressions: 0
                });
            }
            
            updateUI();
            renderLinks();
            addLinkModal.classList.add('hidden');
            linkForm.reset();
        }
        
        // Handle premium link visits with cooldown
        function setupPremiumLinks() {
            const links = [
                { id: 1, button: 'visitPremiumBtn1', countdown: 'countdown1', cooldown: 'cooldown1', text: 'premiumBtnText1' },
                { id: 2, button: 'visitPremiumBtn2', countdown: 'countdown2', cooldown: 'cooldown2', text: 'premiumBtnText2' }
            ];

            links.forEach(link => {
                const btn = document.getElementById(link.button);
                btn.addEventListener('click', () => {
                    if (!state.isLoggedIn) {
                        alert('Please login to claim this offer!');
                        return;
                    }

                    if (btn.dataset.locked === 'true') return;

                    // Start cooldown
                    btn.dataset.locked = 'true';
                    document.getElementById(link.cooldown).classList.remove('hidden');
                    document.getElementById(link.text).textContent = 'Claimed +100 pts';
                    btn.style.backgroundColor = '#10b981';
                    state.user.points += 100;
                    updateUI();

                    let seconds = 120;
                    const timer = setInterval(() => {
                        const mins = Math.floor(seconds / 60);
                        const secs = seconds % 60;
                        document.getElementById(link.countdown).textContent = `${mins}:${secs < 10 ? '0' + secs : secs}`;
                        
                        if (seconds <= 0) {
                            clearInterval(timer);
                            btn.dataset.locked = 'false';
                            document.getElementById(link.cooldown).classList.add('hidden');
                            document.getElementById(link.text).textContent = 'Visit Now';
                            btn.style.backgroundColor = '';
                        }
                        seconds--;
                    }, 1000);

                    // In real app, would redirect here
                    setTimeout(() => {
                        alert(`You earned 100 points! Redirecting to premium ad ${link.id} would happen here.`);
                    }, 500);
                });
            });
        }

        // Call this in init() after DOM elements are ready
        
        // Setup random notifications
        function loadOtherUsersLinks() {
            db.collection('sharedLinks')
                .orderBy('timestamp', 'desc')
                .limit(10)
                .onSnapshot((snapshot) => {
                    const linksList = document.getElementById('otherUserLinksList');
                    linksList.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const linkItem = document.createElement('div');
                        linkItem.className = 'border border-gray-200 rounded-lg p-3 mb-3 last:mb-0';
                        linkItem.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-medium text-gray-800">${data.userName}: ${data.link.title || 'Shared Link'}</p>
                                    <p class="text-sm text-blue-600 truncate">${data.link.url}</p>
                                </div>
                                <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                                    ${data.link.type.charAt(0).toUpperCase() + data.link.type.slice(1)}
                                </span>
                            </div>
                            <div class="flex justify-between items-center mt-2 text-xs">
                                <div class="flex space-x-4">
                                    <span class="text-gray-500 flex items-center">
                                        <i class="fas fa-mouse-pointer mr-1"></i> ${data.clicks}
                                    </span>
                                    <span class="text-gray-500 flex items-center">
                                        <i class="fas fa-eye mr-1"></i> ${data.impressions}
                                    </span>
                                </div>
                                <button class="text-blue-600 hover:text-blue-800 text-sm font-medium view-btn" data-url="${data.link.url}">
                                    View
                                </button>
                            </div>
                        `;
                        linksList.appendChild(linkItem);
                    });
                    
                    if (snapshot.empty) {
                        linksList.innerHTML = '<div class="text-sm text-gray-400 italic">No shared links yet</div>';
                    }
                });
        }

        function setupRandomNotifications() {
            // First notification (top earners)
            setTimeout(() => {
                randomHighEarner.textContent = demoUsers[Math.floor(Math.random() * demoUsers.length)];
                highEarnersNotif.classList.remove('hidden');
                
                setTimeout(() => {
                    highEarnersNotif.classList.add('hidden');
                }, 5000);
            }, 3000);
            
            // Second notification (traffic milestones)
            setTimeout(() => {
                randomTrafficUser.textContent = demoUsers[Math.floor(Math.random() * demoUsers.length)];
                highTrafficNotif.classList.remove('hidden');
                
                setTimeout(() => {
                    highTrafficNotif.classList.add('hidden');
                }, 5000);
            }, 8000);
        }
        
        // Initialize the app
        init();
    </script>
</body>
</html>
